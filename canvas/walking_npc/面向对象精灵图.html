<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>面向对象精灵图</title>
</head>
<body>
    <canvas id="canvas"></canvas><br>
    <button id="up">↑</button>
    <button id="down">↓</button>
    <button id="left">←</button>
    <button id="right">→</button>


<script>
    (function(){
        var canvas = document.getElementById("canvas");
        canvas.width = 600;
        canvas.height = 600;
        canvas.style.border = "1px solid #000";
        var ctx = canvas.getContext("2d");

        //创建精灵图对象
        //对象的参数：
        // 绘制的x，y坐标：x,y
        //对象的速度：fps
        //图片的地址：imgSrc
        //图片绘制的大小：drawW,drawH   截取的大小：cutW,cutH
        //对象行走的方向：dir
        function Sprite( option ){
            this._init(option);
        }
        Sprite.prototype = {
            _init : function(option){
                this.x = option.x === 0 ? 0 :(option.x || 0);
                this.y = option.y === 0 ? 0 :(option.y || 0);
                this.fps = option.fps || 10;
                this.imgSrc = option.imgSrc || "gameImgs/DMMban.png";
                this.drawW = option.drawW || 40 ;
                this.drawH = option.drawH || 65;
                this.cutW = option.cutW || 40;
                this.cutH = option.cutH || 65;
                this.dir = option.dir || 0;
            },
            draw : function(ctx){
                var img = new Image();
                img.src = this.imgSrc;
                var that = this;

               img.onload = function(){
                   var frameIndex = 0;
                   setInterval(function(){
                       ctx.clearRect( 0,0 , ctx.canvas.width , ctx.canvas.height);
                       ctx.drawImage(
                               img,
                               that.cutW* frameIndex,
                               that.cutH*that.dir,
                               that.cutW,
                               that.cutH,
                               that.x,
                               that.y,
                               that.drawW,
                               that.drawH);
                       frameIndex ++;
                       frameIndex %= 4;
                   },1000/that.fps);
               }
            },
            changeDir : function(dir){
                switch (dir){
                    case "left" :
                        this.dir = 1;
                        break;
                    case "right" :
                        this.dir = 2;
                        break;
                    case "up" :
                        this.dir = 3;
                        break;
                    case "down" :
                        this.dir = 0
                }
            }
        }
        var s = new Sprite({
            imgSrc : "gameImgs/NPC4.png",
            x : 300,
            y : 300,
            fps : 4,
            drawW : 80,
            drawH : 130
        });
        s.draw(ctx);

        //绑定按钮的点击事件
        var btnLeft = document.getElementById('left');
        btnLeft.onclick = function() {
            //小哥哥朝着左方向
            // dirIndex = 1;
            s.changeDir('left');
        };

        var btnRight = document.getElementById('right');
        btnRight.onclick = function() {
            //小哥哥朝着方向
            // dirIndex = 2;
            s.changeDir('right');

        };

        var btnUp = document.getElementById("up");
        btnUp.onclick = function() {
            //小哥哥朝着左方向
            // dirIndex = 3;
            s.changeDir('up');

        };

        var btnDown = document.getElementById('down');
        btnDown.onclick = function() {
            //小哥哥朝着左方向
            // dirIndex = 0;
            s.changeDir('down');

        };
    })();
</script>
</body>
</html>